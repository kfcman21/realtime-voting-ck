<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬í‘œ ê´€ë¦¬ì í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-800 font-sans">
    <div class="container max-w-4xl mx-auto p-4 sm:p-6">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-white">ğŸ”‘ íˆ¬í‘œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        </header>

        <div id="admin-section" class="bg-white p-6 rounded-xl shadow-lg">
            <div id="login-form">
                <h2 class="text-2xl font-bold text-slate-700 mb-4 text-center">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                <input type="email" id="admin-email" placeholder="ì´ë©”ì¼" class="w-full p-3 border border-gray-300 rounded-md mb-3">
                <input type="password" id="admin-password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full p-3 border border-gray-300 rounded-md">
                <button onclick="adminLogin()" class="w-full mt-4 bg-blue-600 text-white font-semibold py-3 rounded-md hover:bg-blue-700">ë¡œê·¸ì¸</button>
            </div>
            
            <div id="admin-panel" class="hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 id="welcome-admin" class="text-2xl font-bold text-slate-700">âœ¨ ì£¼ì œ ê´€ë¦¬</h2>
                    <button onclick="adminLogout()" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-600">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                 </div>
                 <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-6">...</div>
                 <hr class="my-6">
                 <div id="topics-list" class="space-y-4"></div>
            </div>
        </div>
    </div>
    <div id="edit-modal" class="hidden ...">...</div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        // Firebase ì„¤ì • ë¶™ì—¬ë„£ê¸°
        const firebaseConfig = { apiKey: "AIzaSyBg6oQzlAEUmKgfoc9wzW_WnRGzCD-NgzI",
  authDomain: "realtime-voting-ck.firebaseapp.com",
  projectId: "realtime-voting-ck",
  storageBucket: "realtime-voting-ck.firebasestorage.app",
  messagingSenderId: "920253088767",
  appId: "1:920253088767:web:51d64912cd92fc18d05dca",
  measurementId: "G-KZBYM1TCG5"
 };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const topicsCollection = db.collection('topics');
        let loggedInAdmin = null; // ë¡œê·¸ì¸í•œ ê´€ë¦¬ì ì •ë³´ ì €ì¥
        
        // ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€
        auth.onAuthStateChanged(user => {
            if (user) {
                // ë¡œê·¸ì¸ ëœ ìƒíƒœ
                loggedInAdmin = user;
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('welcome-admin').innerText = `âœ¨ ${user.email}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤.`;
                startListenerForAdmin(user.uid);
            } else {
                // ë¡œê·¸ì•„ì›ƒ ëœ ìƒíƒœ
                loggedInAdmin = null;
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('admin-panel').classList.add('hidden');
                if (unsubscribe) unsubscribe();
            }
        });

        function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            auth.signInWithEmailAndPassword(email, password).catch(error => {
                alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message);
            });
        }

        function adminLogout() {
            auth.signOut();
        }

        // ì£¼ì œ ìƒì„± ì‹œ adminId(UID) ì¶”ê°€
        async function createTopic() {
            if (!loggedInAdmin) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            const title = document.getElementById('new-topic-title').value.trim();
            const itemsStr = document.getElementById('new-topic-items').value.trim();
            if (!title || !itemsStr) return alert('ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            const items = itemsStr.split(',').map(name => ({ name: name.trim(), votes: 0 }));
            await topicsCollection.add({
                title,
                items,
                adminId: loggedInAdmin.uid, // â˜…â˜…â˜… ë¡œê·¸ì¸í•œ ê´€ë¦¬ìì˜ UID ì €ì¥
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                archivedResults: []
            });
            document.getElementById('new-topic-title').value = '';
            document.getElementById('new-topic-items').value = '';
        }

        let unsubscribe;
        function startListenerForAdmin(adminId) {
            if (unsubscribe) unsubscribe();
            // â˜…â˜…â˜… ë¡œê·¸ì¸í•œ ê´€ë¦¬ìì˜ ì£¼ì œë§Œ í•„í„°ë§
            unsubscribe = topicsCollection.where('adminId', '==', adminId).orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    const topics = snapshot.docs.map(doc => ({ id: doc.id, data: doc.data() }));
                    renderAdminList(topics);
                });
        }
        
        // renderAdminList, openEditModal, saveTopicChanges, resetVotes, saveResults, deleteTopic í•¨ìˆ˜ëŠ”
        // ì´ì „ 'ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€' ë‹µë³€ì˜ ì½”ë“œì™€ ê±°ì˜ ë™ì¼í•˜ë¯€ë¡œ ìƒëµí•©ë‹ˆë‹¤.
        // (í•´ë‹¹ ì½”ë“œ ë¸”ë¡ì„ ì—¬ê¸°ì— ë³µì‚¬í•˜ì—¬ ì‚¬ìš©)
    </script>
</body>
</html>
